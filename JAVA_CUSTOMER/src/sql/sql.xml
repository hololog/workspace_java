<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Customer">

	<resultMap type="CustomerDTO" id="CustomerDTO">
		<result column="IDX" property="idx" />	
		<result column="NAME" property="name" />
		<result column="AGE" property="age" />
		<result column="EMAIL" property="email" />
		<result column="JUMIN" property="jumin" />
	</resultMap>

	<select id="select" resultMap="CustomerDTO">
		SELECT IDX
			 , NAME
			 , AGE
			 , EMAIL
			 , JUMIN
		  FROM CUSTOMER
		 WHERE 1=1
		   <if test="!NAME.equals('') and NAME != null">
		   AND NAME LIKE '%${NAME}%'
		   </if>
		   <if test="!AGE.equals('') and AGE != null">
		   AND AGE = #{AGE}
		   </if>
		   <if test="!JUMIN.equals('') and JUMIN != null">
		   AND JUMIN LIKE CONCAT('%', #{JUMIN}, '%')
		   </if> 	
	</select>
	
	<insert id="insert" parameterType="CustomerDTO">
		INSERT INTO CUSTOMER 
			 ( IDX
			 , NAME
			 , AGE
			 , EMAIL
			 , JUMIN)
		VALUES (
				(SELECT IDX
				   FROM (
						SELECT IFNULL(MAX(CAST(IDX AS UNSIGNED)), 0)  + 1 AS IDX
						  FROM CUSTOMER
					  ) A)
			 , #{name}
			 , #{age}
			 , #{email}
			 , #{jumin}
			 )	 
	</insert>
	
	<delete id="delete">
		DELETE FROM CUSTOMER
		 WHERE IDX = #{idx}
	</delete>
	
</mapper>
